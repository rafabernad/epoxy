<dom-module id="epoxy-behavior">
	<script src="./epoxy.js"></script>
	<script>
	epoxy.createMixin = function(middlewares) {

	  return (base) => class extends base {
	  	constructor() {
	  		super();
	  		this._disposers = !this._disposers && [];
	  	}
	    ready() {
	      this.dispatch = epoxy.dispatch.bind(this, middlewares);
	      super.ready.apply(this, arguments);
	    }

	    connectedCallback() {
	      if (this.constructor.properties) {
	        const stateBindingsDisposers = epoxy.addStatePathBinding(this);
	        this._disposers = this._disposers.concat(stateBindingsDisposers);
	      }

	      if (this.constructor.stateObservers) {
	        const stateObserversDisposers = epoxy.addStateObservers(this);
	        this._disposers = this._disposers.concat(stateObserversDisposers);
	      }
	      super.connectedCallback.apply(this, arguments);
	    }

	    disconnectedCallback() {
	      this._disposers.forEach(disposer => disposer());
	      super.disconnectedCallback.apply(this, arguments);
	    }

	    /**
	     * Gets a field/property of the selected store
	     * @param  {string} store
	     * @param  {string} path
	     * @return {any}  field/property value
	     */
	    getStateProperty(store, path) {
	      const stateProperty = epoxy.deepPathCheck(store, path);

	      return toJS(stateProperty);
	    }
	  };

	}

	epoxy.mixin = epoxy.createMixin();
	</script>
</dom-module>